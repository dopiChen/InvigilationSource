<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatisplus.mapper.ExaminationMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.example.mybatisplus.model.domain.Examination">
        <id column="exam_id" property="examId" />
        <result column="batch_id" property="batchId" />
        <result column="exam_room" property="examRoom" />
        <result column="campus" property="campus" />
        <result column="address" property="address" />
        <result column="from_time" property="fromTime" />
        <result column="end_time" property="endTime" />
    </resultMap>
    <select id="selectemsDTO" resultType="com.example.mybatisplus.model.dto.ExamSignDTO">
        SELECT
            e.exam_id,
            e.exam_room,
            e.from_time,
            e.end_time,
            COUNT(DISTINCT s.username) AS totalnum,
            COUNT(DISTINCT CASE WHEN s.is_comfirm = 1 THEN s.username END) AS count
        FROM
            examination e
            JOIN
            signup s ON e.exam_id = s.exam_id
        WHERE e.exam_room LIKE CONCAT('%', #{examRoom}, '%')
        GROUP BY
            e.exam_id
    </select>
    <select id="selectemsDTO1" resultType="com.example.mybatisplus.model.dto.ExamSignDTO">
        SELECT
            e.exam_id,
            e.exam_room,
            e.from_time,
            e.end_time,
            COUNT(DISTINCT s.username) AS totalnum,
            COUNT(DISTINCT CASE WHEN s.is_comfirm = 1 THEN s.username END) AS count
        FROM
            examination e
            JOIN
            signup s ON e.exam_id = s.exam_id
        GROUP BY
            e.exam_id
    </select>
    <select id="getByBacthId" resultType="java.lang.Integer">
        select exam_id from examination where batch_id = #{id}
    </select>
</mapper>
